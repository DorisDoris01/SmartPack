# SmartPack 预设物品更新 PRD

> **文档类型**：产品需求文档 (PRD)  
> **版本**：v1.0  
> **创建日期**：2026-02-15  
> **状态**：待评审  
> **基于**：SPEC-SmartPack-MVP-Input-Output-Mapping.md

---

## 1. 需求背景

### 1.1 当前状态

SmartPack 应用目前包含以下预设物品结构：

#### 基础清单
- **共有基础项**（7项）：身份证/护照、少量现金、手机充电线、充电宝、创可贴、止泻药、纸巾
- **男性特有项**（9项）：剃须刀、洗面奶、洗发水、面霜、唇膏、发胶、内裤、袜子、睡衣
- **女性特有项**（15项）：卸妆油、洗面奶、洗发水、护发素、化妆品、面膜、精华、防晒霜、化妆棉、发圈、备用卫生棉/棉条、内裤、袜子、睡衣、内衣 (Bra)

#### 旅行活动标签对应物品（8个标签，共42项）
- **跑步**（5项）：跑鞋、排汗衣裤、运动袜、导汗带、运动补给（能量胶）
- **攀岩**（5项）：攀岩鞋、粉袋、安全带、头盔、主锁/快挂
- **潜水**（5项）：面镜、呼吸管、潜水电脑表、水母衣、防水袋
- **露营**（6项）：帐篷、睡袋、防潮垫、头灯、营地灯、驱蚊水
- **越野**（5项）：越野跑鞋、水袋背包、急救毯、凡士林（防磨）、强光头灯
- **摄影**（6项）：相机机身、镜头群、备用电池、存储卡、三脚架、清洁套装
- **摩旅**（5项）：头盔、骑行服/护具、雨衣、维修工具、蓝牙耳机（对讲）
- **骑行**（5项）：骑行裤（垫裆）、头盔、手套、便携打气筒、组合工具

#### 特定场合标签对应物品（3个标签，共15项）
- **宴会**（5项）：礼服/西装、皮鞋/高跟鞋、配饰（领带/珠宝）、发胶、熨斗
- **商务会议**（5项）：正装、笔记本电脑、演示翻页笔、名片、文件夹/笔
- **自驾**（5项）：驾驶证、车载充电器、手机支架、应急补胎液、墨镜

#### 出行配置标签对应物品（3个标签，共18项）
- **国际旅行**（6项）：护照、签证、转换插头、eSIM/流量卡、外币、常备药
- **带娃**（6项）：尿布、奶瓶/奶粉、湿巾、折叠推车、安抚玩具、儿童药品
- **带宠物**（6项）：牵引绳、便便袋、折叠碗、宠物口粮、疫苗证明、航空箱

**总计**：基础清单 31项 (7共有 + 9男性 + 15女性) + 标签物品 75项 (42活动 + 15场合 + 18配置) = **106项预设物品**

### 1.2 改动动机

用户希望更新预设物品列表，以：
- 优化物品的实用性和准确性
- 补充遗漏的重要物品
- 移除不常用或过时的物品
- 调整物品分类和命名
- 提升用户体验和清单生成质量

---

## 2. 改动范围

### 2.1 改动类型

本次改动可能涉及以下类型：

1. **新增物品**
   - 在现有标签下添加新的预设物品
   - 创建新的标签并添加对应物品

2. **删除物品**
   - 移除不再需要的预设物品
   - 注意：需考虑对已有行程的影响（标记为"已删除"而非物理删除）

3. **修改物品**
   - 更新物品名称（中文/英文）
   - 调整物品分类（category）
   - 修改物品的性别特定属性（genderSpecific）

4. **调整标签**
   - 新增标签组或标签
   - 删除标签组或标签
   - 修改标签名称或图标
   - 调整标签与物品的关联关系

5. **优化基础清单**
   - 调整共有基础项
   - 调整性别特有项

6. **物品去重机制**
   - 当用户选择多个标签时，确保生成的清单中不出现重复物品
   - 基于物品名称（中英文）进行去重，避免相同物品重复显示

### 2.2 改动影响范围

- **数据层**：`PresetData.swift` 中的 `itemList` 和 `tagList`
- **基础清单逻辑**：`commonBaseItemIds`、`maleSpecificItemIds`、`femaleSpecificItemIds`
- **清单生成逻辑**：`generatePackingList()` 方法（需增强去重逻辑）
- **Item 管理功能**：`ItemManagementView.swift` 中的展示逻辑
- **已有行程数据**：需考虑向后兼容性

---

## 3. 新增需求：物品去重机制

### 3.0 物品去重需求

**需求描述**：当用户选择了多个场景（标签）时，如果生成的物品清单中有重复物品（相同名称），需要自动去重，确保每个物品在清单中只出现一次。

**问题场景**：
- 用户同时选择"攀岩"、"摩旅"、"骑行"三个标签
- 这三个标签都包含"头盔"物品（但 ID 不同：`act_climb_004`、`act_moto_001`、`act_bike_002`）
- 当前实现基于 ID 去重，不会识别这些为重复物品
- 导致清单中出现多个"头盔"物品

**解决方案**：
- 在 `generatePackingList()` 方法中，添加基于物品名称（中英文）的去重逻辑
- 使用 `Set<String>` 记录已添加的物品名称
- 添加物品前检查名称是否已存在，如存在则跳过

**实现位置**：`PresetData.swift` 的 `generatePackingList()` 方法

**优先级**：P0（高优先级）

**已知重复物品示例**：
- **"头盔"**：出现在"攀岩"（`act_climb_004`）、"摩旅"（`act_moto_001`）、"骑行"（`act_bike_002`）三个标签中
- 其他可能的重复物品需要在实际使用中发现和记录

**测试用例**：
1. 选择"攀岩"+"摩旅"+"骑行"三个标签，验证"头盔"只出现一次
2. 选择包含其他可能重复物品的多个标签，验证去重效果

---

## 4. 具体改动需求

> **注意**：以下为模板，请根据实际需求填写具体改动内容。

### 3.1 基础清单改动

#### 3.1.1 共有基础项改动

| 操作 | 物品ID | 物品名称（中文） | 物品名称（英文） | 分类 | 说明 |
|------|--------|------------------|------------------|------|------|
| 新增 | `base_xxx_xxx` | | | | |
| 删除 | `base_xxx_xxx` | | | | |
| 修改 | `base_xxx_xxx` | | | | |

#### 3.1.2 男性特有项改动

| 操作 | 物品ID | 物品名称（中文） | 物品名称（英文） | 分类 | 说明 |
|------|--------|------------------|------------------|------|------|
| 新增 | `male_xxx` | | | | |
| 删除 | `male_xxx` | | | | |
| 修改 | `male_xxx` | | | | |

#### 3.1.3 女性特有项改动

| 操作 | 物品ID | 物品名称（中文） | 物品名称（英文） | 分类 | 说明 |
|------|--------|------------------|------------------|------|------|
| 新增 | `female_xxx` | | | | |
| 删除 | `female_xxx` | | | | |
| 修改 | `female_xxx` | | | | |

### 3.2 旅行活动标签物品改动

#### 3.2.1 跑步标签改动

| 操作 | 物品ID | 物品名称（中文） | 物品名称（英文） | 分类 | 说明 |
|------|--------|------------------|------------------|------|------|
| 新增 | `act_run_xxx` | | | | |
| 删除 | `act_run_xxx` | | | | |
| 修改 | `act_run_xxx` | | | | |

#### 3.2.2 攀岩标签改动

| 操作 | 物品ID | 物品名称（中文） | 物品名称（英文） | 分类 | 说明 |
|------|--------|------------------|------------------|------|------|
| | | | | | |

#### 3.2.3 潜水标签改动

| 操作 | 物品ID | 物品名称（中文） | 物品名称（英文） | 分类 | 说明 |
|------|--------|------------------|------------------|------|------|
| | | | | | |

#### 3.2.4 露营标签改动

| 操作 | 物品ID | 物品名称（中文） | 物品名称（英文） | 分类 | 说明 |
|------|--------|------------------|------------------|------|------|
| | | | | | |

#### 3.2.5 越野标签改动

| 操作 | 物品ID | 物品名称（中文） | 物品名称（英文） | 分类 | 说明 |
|------|--------|------------------|------------------|------|------|
| | | | | | |

#### 3.2.6 摄影标签改动

| 操作 | 物品ID | 物品名称（中文） | 物品名称（英文） | 分类 | 说明 |
|------|--------|------------------|------------------|------|------|
| | | | | | |

#### 3.2.7 摩旅标签改动

| 操作 | 物品ID | 物品名称（中文） | 物品名称（英文） | 分类 | 说明 |
|------|--------|------------------|------------------|------|------|
| | | | | | |

#### 3.2.8 骑行标签改动

| 操作 | 物品ID | 物品名称（中文） | 物品名称（英文） | 分类 | 说明 |
|------|--------|------------------|------------------|------|------|
| | | | | | |

#### 3.2.9 新增旅行活动标签（如有）

| 标签ID | 标签名称（中文） | 标签名称（英文） | 图标 | 物品列表 |
|--------|------------------|------------------|------|----------|
| `act_xxx` | | | | |

### 3.3 特定场合标签物品改动

#### 3.3.1 宴会标签改动

| 操作 | 物品ID | 物品名称（中文） | 物品名称（英文） | 分类 | 说明 |
|------|--------|------------------|------------------|------|------|
| | | | | | |

#### 3.3.2 商务会议标签改动

| 操作 | 物品ID | 物品名称（中文） | 物品名称（英文） | 分类 | 说明 |
|------|--------|------------------|------------------|------|------|
| | | | | | |

#### 3.3.3 自驾标签改动

| 操作 | 物品ID | 物品名称（中文） | 物品名称（英文） | 分类 | 说明 |
|------|--------|------------------|------------------|------|------|
| | | | | | |

#### 3.3.4 新增特定场合标签（如有）

| 标签ID | 标签名称（中文） | 标签名称（英文） | 图标 | 物品列表 |
|--------|------------------|------------------|------|----------|
| `occ_xxx` | | | | |

### 3.4 出行配置标签物品改动

#### 3.4.1 国际旅行标签改动

| 操作 | 物品ID | 物品名称（中文） | 物品名称（英文） | 分类 | 说明 |
|------|--------|------------------|------------------|------|------|
| | | | | | |

#### 3.4.2 带娃标签改动

| 操作 | 物品ID | 物品名称（中文） | 物品名称（英文） | 分类 | 说明 |
|------|--------|------------------|------------------|------|------|
| | | | | | |

#### 3.4.3 带宠物标签改动

| 操作 | 物品ID | 物品名称（中文） | 物品名称（英文） | 分类 | 说明 |
|------|--------|------------------|------------------|------|------|
| | | | | | |

#### 3.4.4 新增出行配置标签（如有）

| 标签ID | 标签名称（中文） | 标签名称（英文） | 图标 | 物品列表 |
|--------|------------------|------------------|------|----------|
| `cfg_xxx` | | | | |

---

## 5. 技术实现要求

### 4.1 数据兼容性

- **向后兼容**：已删除的预设物品不应影响已有行程的显示
- **数据迁移**：如需要，考虑为已有行程添加数据迁移逻辑
- **ID 规范**：新增物品需遵循现有 ID 命名规范
  - 基础项：`base_{category}_{序号}`
  - 性别项：`{gender}_{序号}`
  - 活动项：`act_{activity}_{序号}`
  - 场合项：`occ_{occasion}_{序号}`
  - 配置项：`cfg_{config}_{序号}`

### 4.2 删除策略

- **软删除**：预设物品删除应采用软删除机制（通过 `CustomItemManager` 的 `deletedPresetItemIds`）
- **用户提示**：删除预设物品时，需提示用户该操作的影响范围
- **恢复机制**：考虑提供恢复已删除预设物品的功能

### 4.3 分类规范

物品分类需符合 `ItemCategory` 枚举：
- `.documents` - 证件/钱财
- `.clothing` - 衣物
- `.toiletries` - 洗漱用品
- `.electronics` - 电子产品
- `.sports` - 运动装备
- `.other` - 其他

### 4.4 双语支持

所有物品和标签需提供中英文名称：
- `name`：中文名称
- `nameEn`：英文名称

### 4.5 物品去重机制

#### 4.5.1 去重需求

当用户选择多个标签时，生成的清单中可能出现重复物品。需要实现去重机制，确保：
- **基于物品名称去重**：如果两个物品的中文名称或英文名称相同，视为重复物品
- **去重优先级**：保留第一个出现的物品（按基础清单 → 标签物品的顺序）
- **自定义物品去重**：自定义物品也需要参与去重，避免与预设物品重复

#### 4.5.2 当前实现状态

当前代码使用 `Set<String>` 存储物品 ID，已实现基于 ID 的去重。但存在以下问题：
- 不同标签可能包含相同名称但不同 ID 的物品（如"头盔"在攀岩、摩旅、骑行标签中都有，但 ID 不同）
- 这些物品不会被去重，导致清单中出现重复物品

#### 4.5.3 实现方案

**方案一：基于名称去重（推荐）**
- 在 `generatePackingList()` 方法中，使用 `Set<String>` 记录已添加的物品名称（中英文）
- 添加物品前检查名称是否已存在，如存在则跳过
- 优点：简单直接，符合用户需求
- 缺点：如果确实需要多个相同名称的物品（如多个"存储卡"），会被误去重

**方案二：基于 ID 合并相同名称物品**
- 识别相同名称的物品，统一使用一个 ID
- 在数据层合并这些物品的 ID 引用
- 优点：数据一致性更好
- 缺点：需要修改数据结构和标签关联

**推荐使用方案一**，在清单生成时进行名称去重。

#### 4.5.4 去重逻辑示例

```swift
// 伪代码示例
var addedItemNames = Set<String>() // 记录已添加的物品名称（中英文）

for itemId in itemSet {
    if let item = allItems[itemId] {
        // 检查是否重复（基于名称）
        let nameKey = "\(item.name)|\(item.nameEn)"
        if !addedItemNames.contains(nameKey) {
            addedItemNames.insert(nameKey)
            tripItems.append(item.toTripItem())
        }
    }
}
```

---

## 6. 测试要求

### 5.1 功能测试

- [ ] 新增物品在对应标签下正确显示
- [ ] 删除物品不影响已有行程（已删除物品在已有行程中仍可见）
- [ ] 修改物品名称后，新创建的行程使用新名称
- [ ] 新增标签在创建行程页面正确显示
- [ ] 清单生成逻辑正确包含所有改动后的物品
- [ ] **多标签选择时，相同名称的物品正确去重**
- [ ] **自定义物品与预设物品名称相同时，正确去重**

### 5.2 兼容性测试

- [ ] 已有行程数据正常加载和显示
- [ ] 用户自定义物品不受影响
- [ ] Item 管理页面正确显示所有改动

### 5.3 边界测试

- [ ] 删除所有标签物品后的处理
- [ ] 新增大量物品后的性能表现
- [ ] 空标签的处理逻辑
- [ ] **选择多个包含相同物品的标签时，去重逻辑正确工作**
- [ ] **中英文名称部分相同但不同时的处理（如"存储卡"和"存储卡（备用）"）**

---

## 7. 实施计划

### 6.1 实施步骤

1. **需求确认**
   - [ ] 评审本 PRD 文档
   - [ ] 确认具体改动内容
   - [ ] 确认改动优先级

2. **数据准备**
   - [ ] 整理所有改动物品的完整信息（ID、名称、分类等）
   - [ ] 准备新增标签的信息（如有）
   - [ ] 确认物品分类和性别属性

3. **代码实现**
   - [ ] 更新 `PresetData.swift` 中的 `itemList`
   - [ ] 更新 `PresetData.swift` 中的 `tagList`（如有标签改动）
   - [ ] 更新基础清单 ID 列表（如有基础清单改动）
   - [ ] **实现物品去重逻辑**：在 `generatePackingList()` 方法中添加基于名称的去重机制
   - [ ] 更新相关注释和文档

4. **测试验证**
   - [ ] 执行功能测试
   - [ ] 执行兼容性测试
   - [ ] 执行边界测试

5. **文档更新**
   - [ ] 更新 `SPEC-SmartPack-MVP-Input-Output-Mapping.md`
   - [ ] 更新本 PRD 文档状态为"已完成"
   - [ ] 更新代码注释

### 6.2 风险评估

| 风险 | 影响 | 应对措施 |
|------|------|----------|
| 已有行程数据丢失 | 高 | 采用软删除机制，保留已删除物品的引用 |
| 用户自定义物品冲突 | 中 | 确保自定义物品 ID 与预设物品 ID 不冲突 |
| 性能影响 | 低 | 物品数量增加有限，预计影响较小 |
| 翻译质量 | 中 | 确保英文名称准确，可参考专业术语 |

---

## 8. 验收标准

### 7.1 功能验收

- ✅ 所有新增物品在对应标签下正确显示
- ✅ 所有删除物品不再出现在新创建的行程中
- ✅ 所有修改物品使用新的名称和属性
- ✅ 清单生成逻辑正确工作
- ✅ Item 管理页面正确显示所有改动
- ✅ **多标签选择时，相同名称的物品只出现一次（去重成功）**
- ✅ **自定义物品与预设物品名称相同时，正确去重**

### 7.2 质量验收

- ✅ 代码符合现有代码规范
- ✅ 所有改动有适当的注释说明
- ✅ 相关文档已更新
- ✅ 无回归问题

---

## 9. 附录

### 8.1 相关文档

- `SPEC-SmartPack-MVP-Input-Output-Mapping.md` - 需求规格说明
- `PresetData.swift` - 预设数据实现文件
- `CustomItemManager.swift` - 自定义物品管理
- `ItemManagementView.swift` - Item 管理界面

### 8.2 参考资源

- SF Symbols 图标库（用于标签图标）
- 物品分类标准
- 双语翻译参考

---

**文档状态**：待填写具体改动内容  
**下一步**：请在本 PRD 的第 3 节中填写具体的改动需求，然后进行评审和实施。
