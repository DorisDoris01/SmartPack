# 产品需求文档 (PRD) - SmartPack (暂定名) v1.4

> **本文档为项目产品文档主入口，后续开发与讨论均以本 PRD 为参考。**

| 文档版本 | v1.4（修正标签与 Item 关系 + Item 管理） |
| --- | --- |
| **项目名称** | 智能打包清单 (SmartPack) |
| **MVP 范围** | 首次欢迎页（性别选择）；首页行程列表；新建行程入口为 "+"；右上角菜单（设置/Item管理）；无算法；标签→预设物品组装；行程持久化存储；支持中/英双语；支持行程归档（Archive） |
| **产品定位** | 基于「场景」的行李打包助手 |
| **核心价值** | 解决多场景旅行下的物品遗漏与决策疲劳 |
| **目标用户** | 经常出差/旅行，且有特定爱好（如跑步、户外、摄影）的人群 |
| **平台** | iOS |

---

## 文档版本历史

| 版本 | 日期 | 说明 | 相关 Spec |
|------|------|------|-----------|
| **v1.5** | 2026-02-02 | 交互优化 + Live Activity | [SPEC v1.5](../docs/SPEC-SmartPack-v1.5.md) |
| **v1.4** | 2026-02-02 | 修正标签与 Item 关系 + Item 管理 | [SPEC Input-Output Mapping](../docs/SPEC-SmartPack-MVP-Input-Output-Mapping.md) |
| v1.3 | - | UI/UX 优化 + 自定义标签 + 行程归档 | - |
| v1.2 | - | 首次欢迎页 + 性别设置 | - |
| v1.1 | - | MVP 初始版本 | - |

> **注意**：v1.5 版本的详细需求请参考 [SPEC-SmartPack-v1.5.md](../docs/SPEC-SmartPack-v1.5.md)

---

## 核心概念定义

> **重要：以下定义是整个系统的基础，开发前请务必理解。**

### 标签组 (Tag Group)
- **定义**：标签的分类容器，如「场景」「运动」
- **关系**：标签组 → 标签 = **一对多**
- **用户权限**：**不可**新增/修改/删除（预设固定）

### 标签 (Tag)
- **定义**：具体的场景或活动，如「正式晚宴」「跑步」「海滩」
- **关系**：标签 → Item = **一对多**
- **用户权限**：**不可**新增/修改/删除（预设固定）

### Item (物品)
- **定义**：需要打包的具体物件，如「护照」「高跟鞋」「泳镜」
- **关系**：属于某个标签（一个 Item 可属于多个标签）
- **用户权限**：
  - 预设 Item：**不可**删除（系统内置）
  - 自定义 Item：用户可在任意标签下**新增/删除**
  - **约束**：每个标签下至少保留 1 个 Item
  - **自定义 Item 格式**：仅需纯文本名称（无需双语、无需 icon）

### 举例说明

```
标签组: 场景
├── 标签: 正式晚宴
│   ├── Item: 礼服 (预设，不可删除)
│   ├── Item: 高跟鞋 (预设，不可删除)
│   ├── Item: 香水 (预设，不可删除)
│   └── Item: 项链 (用户新增，可删除)
└── 标签: 商务会面
    ├── Item: 笔记本电脑 (预设)
    └── Item: 名片 (预设)

标签组: 运动
├── 标签: 跑步
│   ├── Item: 跑鞋 (预设)
│   └── Item: 运动手表 (预设)
└── 标签: 游泳
    ├── Item: 泳衣 (预设)
    └── Item: 泳镜 (预设)
```

**生成行程时的逻辑**：用户选择「正式晚宴」标签 → 系统自动把该标签下的所有 Item（礼服、高跟鞋、香水、项链）加入行程清单。

---

## 变更说明（v1.4）

- **修正核心概念**
  - 新增「核心概念定义」章节，明确「标签组 → 标签 → Item」的层级关系与用户权限。
  - 标签组、标签均为**预设固定**，用户不可修改。
  - 用户可自定义的是 **Item**（在标签下新增/删除物品）。
- **模块调整**
  - 「标签管理」更名为「Item 管理」，功能调整为管理标签下的物品。
  - 自定义 Item 仅需纯文本名称，无需双语和 icon。
- **首页简化**
  - 首页改为标准原生 List，移除半屏卡片自定义拖动交互，提升稳定性。

## 变更说明（v1.3）

- 首页行程列表改为半屏卡片（已在 v1.4 中移除）。
- 标签展示需包含 icon + 简洁文案。
- 新增行程归档（Archive）功能。

## 变更说明（v1.2）

- 新增首次欢迎页（性别选择）。
- 调整核心页面结构。
- 设置页新增性别设置。

---

## MVP 原则

MVP 的核心原则是：**用最少的功能，验证最核心的价值（场景化清单展示）。**

- **暂不支持算法：** 不做数量计算、条件公式，清单由「标签 → 预设物品」直接组装。
- **暂不支持用户修改已生成的清单：** 生成后的清单仅支持勾选/取消勾选，不可增删改物品或数量。
- **生成逻辑：** 预设每个标签对应的 Item 列表，用户选择标签后，将各标签下的 Item 合并去重后展示。
- 暂时剔除天气接口、社交分享、电商链接等干扰项。

---

## 1. 用户流程图 (User Flow)

App 采用「首页行程列表」的信息架构：三大核心页面为 **首页（Home）**、**新建行程（Create）**、**设置（Settings）**。设置与 Item 管理入口通过右上角菜单进入。

### 1.0 首次启动（欢迎页）
1. **首次打开 App** → 从底部弹出 **欢迎卡片**（原生 UI）。
2. **介绍 App**（简短 2-3 行）：说明这是一个基于场景的打包清单工具，帮用户减少遗漏。
3. **引导选择性别**（男/女）→ 保存为用户偏好。
4. 进入 **首页（Home）**。

### 1.1 核心路径：新建行程
入口：首页导航栏 "+"

1. **输入变量**（出行时长、标签选择）。
2. **生成并保存**（系统按预设组装物品，自动保存至「首页行程列表」，默认命名为「标签 + 日期」）。
3. **打包执行**（在行程的物品页进行勾选）。

### 1.2 辅助路径：行程管理
1. **查看历史**（查看已创建的所有行程及其勾选状态）。
2. **复用行程**（点击进入行程，支持「一键清空」所有复选框，方便第二次出行）。
3. **删除行程**（长按或侧滑删除不再需要的行程）。
4. **归档行程**（行程完成后可选择归档；归档行程在列表置底并与 Active 区分）。

### 1.3 设置入口
入口：首页右上角菜单 → 「设置」「Item 管理」。

### 1.4 Item 管理入口
入口：首页右上角菜单 → 「Item 管理」。

---

## 2. 功能需求详情 (Functional Requirements)

### 2.0 模块零：首次欢迎页 (Onboarding)

| ID | 功能点 | 优先级 | 详细描述/逻辑 |
| --- | --- | --- | --- |
| **F-0.1** | **欢迎卡片呈现** | **P0** | App 首次启动时，从底部向上弹出卡片（原生 UI 实现）；**未完成性别选择前不允许关闭/跳过**，完成选择后卡片自动收起并进入主流程。 |
| **F-0.2** | **App 简介文案** | **P0** | 卡片内包含简短介绍（2-3 行），强调"按场景生成清单、减少遗漏"。 |
| **F-0.3** | **性别选择** | **P0** | 用户选择：**男 / 女**。用于过滤性别相关物品。 |
| **F-0.4** | **选择结果持久化** | **P0** | 性别选择需保存为用户偏好；后续启动不再展示欢迎页。 |

### 2.1 模块一：新建行程（行程配置）(Create)

| ID | 功能点 | 优先级 | 详细描述/逻辑 |
| --- | --- | --- | --- |
| **F-1.0** | **性别来源** | **P0** | 新建行程时自动读取用户设置中的性别，并写入行程的 `gender` 字段用于过滤逻辑；创建页不重复要求用户选择。 |
| **F-1.1** | **入口："+"** | **P0** | 首页导航栏提供 "+"，点击进入新建行程页。 |
| **F-1.2** | **Section 1: 出行时长** | **P0** | 简化为四档单选：<br>1. **短途**（3天以内）<br>2. **中途**（3-7天）<br>3. **长途**（7-14天）<br>4. **极长途**（14天以上） |
| **F-1.3** | **Section 2: 标签选择（按标签组）** | **P0** | 按标签组展示标签：<br>- 标签组 A：**场景**（商务会面/正式晚宴…）<br>- 标签组 B：**运动**（跑步/游泳/瑜伽…） |
| **F-1.4** | **标签展示信息** | **P0** | 每个标签需要同时展示：**icon + 简洁文案**。 |

### 2.2 模块二：行程生成与存储

| ID | 功能点 | 优先级 | 详细描述/逻辑 |
| --- | --- | --- | --- |
| **F-2.1** | **自动保存** | **P0** | 行程生成后立即持久化存储至本地数据库。 |
| **F-2.2** | **预设映射** | **P0** | 见第 3 节「标签及对应 Item 预设」。 |

### 2.3 模块三：首页（Home）

| ID | 功能点 | 优先级 | 详细描述/逻辑 |
| --- | --- | --- | --- |
| **F-3.0** | **行程列表** | **P0** | 使用原生 List 组件展示所有已创建行程。 |
| **F-3.1** | **行程列表内容** | **P0** | 展示所有已创建行程，显示名称、创建日期、打包进度；区分 Active 与 Archived。 |
| **F-3.2** | **状态持久化** | **P0** | 实时记录每个 Item 的 checkbox 勾选状态，退出 App 后重新进入状态保持。 |
| **F-3.3** | **一键清空** | **P0** | 行程物品页提供「重置/清空」按钮，点击后所有 Item 恢复未勾选状态。 |
| **F-3.4** | **删除功能** | **P0** | 支持用户删除历史行程。 |
| **F-3.5** | **归档展示规则** | **P0** | 归档行程在列表置底，与 Active 行程做轻量区分。 |

### 2.4 模块四：设置 (Settings)

| ID | 功能点 | 优先级 | 详细描述/逻辑 |
| --- | --- | --- | --- |
| **F-4.1** | **语言切换** | **P0** | 支持中/英双语切换。 |
| **F-4.2** | **性别设置** | **P0** | 增加性别选项（男/女），可修改首次欢迎页的选择；修改后影响**后续新建行程**的过滤逻辑。 |

### 2.5 模块五：Item 管理 (Item Management)

| ID | 功能点 | 优先级 | 详细描述/逻辑 |
| --- | --- | --- | --- |
| **F-5.0** | **入口** | **P0** | 首页右上角菜单提供「Item 管理」入口。 |
| **F-5.1** | **Item 管理页展示** | **P0** | 按「标签组 → 标签 → Item」层级展示。用户可展开查看每个标签下的 Item 列表。 |
| **F-5.2** | **新增 Item** | **P0** | 用户可在任意标签下新增自定义 Item。<br>- 仅需输入**纯文本名称**（无需双语、无需 icon）。<br>- 新增的 Item 会在该标签被选择时自动加入行程。 |
| **F-5.3** | **删除 Item** | **P0** | 用户可删除**自定义 Item**；**预设 Item 不可删除**。<br>- **约束**：每个标签下至少保留 1 个 Item，不足时禁止删除并提示。 |
| **F-5.4** | **标签组/标签限制** | **P0** | 标签组和标签均为预设，用户不可新增/修改/删除。 |

### 2.6 模块六：行程归档 (Archive)

| ID | 功能点 | 优先级 | 详细描述/逻辑 |
| --- | --- | --- | --- |
| **F-6.1** | **完成庆祝动画** | **P0** | 当行程所有物品勾选完成时，触发全屏撒花/庆祝动画。 |
| **F-6.2** | **归档确认弹窗** | **P0** | 动画同时弹窗祝贺，并询问是否将行程归档（Yes/No）。 |
| **F-6.3** | **归档状态持久化** | **P0** | 行程需持久化字段 `isArchived`；归档后仍可进入查看与复用/重置。 |
| **F-6.4** | **归档列表排序** | **P0** | Active 行程在前；Archived 行程置底（同组内按时间倒序）。 |

---

## 3. 标签及对应 Item 预设 (Tag & Items)

以下为 MVP 版本内置的标签组、标签及其对应的 Item：

### 3.0 通用 (无论用户选择什么标签，都会包含)
- **证件/钱财**：身份证/护照、现金、信用卡、行程单
- **电子产品**：手机、充电宝、充电线、耳机
- **洗漱/个人**：牙刷、牙膏、洗面奶、纸巾
- **衣物**：内衣裤、袜子、睡衣

### 3.1 标签组：场景 (Scene)

| 标签 | 预设 Item |
| --- | --- |
| **商务会面** | 笔记本电脑、电脑充电器、笔记本/笔、名片、正装衬衫、西装外套、皮鞋 |
| **正式晚宴** | 礼服/西服、领带/配饰、正装鞋、香水 |

### 3.2 标签组：运动 (Sports)

| 标签 | 预设 Item |
| --- | --- |
| **跑步** | 跑鞋、运动袜、速干衣、运动短裤、运动手表、能量胶 |
| **游泳** | 泳衣、泳镜、泳帽、毛巾、防水袋 |
| **瑜伽** | 瑜伽服、瑜伽铺巾、拉力带 |

---

## 4. 数据结构示例 (Schema Example)

### 4.1 Trip (行程实例)
```json
{
  "id": "uuid",
  "name": "上海商务出差 - 2026/02/01",
  "gender": "male",
  "duration": "3-7days",
  "selectedTags": ["business", "running"],
  "isArchived": false,
  "items": [
    { "id": "item_1", "name": "衬衫", "isChecked": true },
    { "id": "item_2", "name": "跑鞋", "isChecked": false }
  ],
  "createdAt": "2026-02-01T10:00:00Z"
}
```

### 4.2 自定义 Item 存储
```json
{
  "customItems": {
    "formal_dinner": ["项链", "手表"],
    "running": ["护膝"]
  }
}
```
> 说明：`customItems` 存储用户在各标签下新增的自定义 Item。Key 为标签 ID，Value 为该标签下用户新增的 Item 名称数组。

---

## 5. UI 规范与交互约束（MVP）

1. **按钮尺寸一致**：所有按钮需使用统一的点击热区与视觉尺寸。
2. **去掉不必要文案**：图标按钮默认不展示多余文字；仅在信息不足以自解释时才加文案（需保留可访问性标签）。
3. **入口规则明确**：
   - 首页导航栏右侧："+" → 新建行程
   - 首页导航栏右侧：菜单 → 「设置」「Item 管理」
4. **标签可理解性**：标签必须同时展示 icon 与文案。
5. **暗黑模式适配**：所有界面需适配暗黑模式。
6. **动效克制**：庆祝动画需"低干扰、不卡顿、可中断"。

---

## 6. 非功能性需求 (Non-Functional Requirements)

1. **离线可用**：核心功能（查看/勾选清单）必须支持离线使用。
2. **持久化存储**：使用 SwiftData 存储用户行程和自定义 Item。
3. **多语言**：支持中/英双语切换，包括 UI 文案和预设物品名称。

---

## 7. 埋点指标 (MVP Metrics)

1. **留存率**：用户第二次打开 App 并使用「一键清空」复用清单的比例。
2. **行程创建数**：人均创建行程的数量。
3. **标签分布**：哪些标签被组合使用的频率最高。
4. **自定义 Item 使用率**：用户新增自定义 Item 的比例。

---

## 下一步建议

1. **代码重构**：根据新的概念定义，重构 Item 管理相关代码。
2. **数据迁移**：如有旧数据，需考虑迁移方案。
3. **Item 库扩充**：根据用户反馈进一步丰富预设 Item。

---

*文档维护：如有 PRD 更新，请同步修改本文件并注明版本与变更说明。*
